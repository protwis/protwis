{% extends "home/base.html" %}
{% load static %}
{% load structure_extras %}
{% block addon_css %}
<link rel="stylesheet" href="{% static 'home/css/gprottree.css' %}" media="screen" />
{% endblock %}
{% block content %}

<!-- styles needed? -->
<!-- <link href="{% static 'home/css/prettify.css' %}" rel="stylesheet" media="screen"> -->
<link href="{% static 'home/css/color_picker.css' %}" rel="stylesheet" media="screen">
<link href="{% static 'home/css/bootstrap-responsive.css' %}" rel="stylesheet" media="screen">
<link href="{% static 'home/css/jquery.dataTables.min.css' %}" rel="stylesheet" media="screen">
<link href="{% static 'home/css/yadcf_bootstrap_version.css' %}" rel="stylesheet" media="screen">
<link href="{% static 'home/css/targetselect_functions.css' %}" rel="stylesheet" media="screen">
<link href="{% static 'home/css/select2.css' %}" rel="stylesheet" media="screen">
<link href="https://gitcdn.github.io/bootstrap-toggle/2.2.2/css/bootstrap-toggle.min.css" rel="stylesheet">


<script src="{% static 'home/js/jquery.min.js' %}"></script>
<script src="{% static 'home/js/selection.js' %}"></script>


<script language="Javascript">
  //creating a dictionary for the path translation
  const trackTranslate = {
    '0123': "resultC111100",  '023': "resultC101100",  '123': "resultC011100",
    '012': "resultC111000",  '02': "resultC101000",  '12': "resultC011000",
    '013': "resultC110100",  '03': "resultC100100",  '13': "resultC010100",
    '01': "resultC110000",  '0': "resultC100000",  '1': "resultC010000",
    '23': "resultC001100", '2': "resultC001000", '3': "resultC000100"
  };

  function clear_select_segmentselection(form) {

    ClearSelection('targets')
    //Dealing with csrf token
    function getCookie(c_name) {
        if (document.cookie.length > 0) {
            c_start = document.cookie.indexOf(c_name + "=");
            if (c_start != -1) {
                c_start = c_start + c_name.length + 1;
                c_end = document.cookie.indexOf(";", c_start);
                if (c_end == -1) c_end = document.cookie.length;
                return unescape(document.cookie.substring(c_start, c_end));
            }
        }
        return "";
    }
    $.ajaxSetup({
        headers: { "X-CSRFToken": getCookie("csrftoken") }
    });
    //Actual post
    var fd = new FormData(form);
    $.ajax({
        type: 'POST',
        url: '/common/targetformread',
        data: fd,
        cache: false,
        processData: false,
        contentType: false,
        'success': function (data) {
            location.href="/alignment/segmentselection";
            console.log('ready!');
        },
    }).fail(function (jqXHR, textStatus, error) {
        alert("Request failed: " + textStatus + error);
    });
    return false;
}
    {% if render_part != "tree" %}
      $(document).ready(function () {
        var colorDefault = ["#5a9bd4", "#f15a60", "#808080", "#006600"],
          displayMode  = "classic",
          displaySwitch = false,
          displayStat  = false,
          shortNumber  = true,
          fontSize     = "16px",
          fontFamily   = "Arial";

          gdata = {{ ClassA_gtp_plus|safe }};
          gprotein_ID = {{ ClassA_gtp_plus_keys|safe }};

        function copyToClipboard(txt) {
            var cb = document.getElementById("cb");
            cb.value = txt.slice(0, -1);
            cb.style.display='block';
            cb.select();
            document.execCommand('copy');
            cb.style.display='none';
            showAlert("Shown receptors have been copied to your clipboard.", "info");
        }

        function getArrayFromData(gprotein) {
          var lines = gdata[gprotein].split("\n");
          var table = new Array();
          for (var lindex in lines) {
            table.push(lines[lindex].trim());
          }
          return (table);
        }

        var table_options = {
                         "paging":       true,
                         "pageLength":   10,
                         "lengthChange": false,
                         "order":        [[ 3, "desc" ]],
                         "scrollX":      false,
                         "deferRender": true,
                        }
        // init datattable
        datatable = $("#receptor_table").DataTable(table_options);

        var yadcf_options = [];
        var list = [0, 1, 2, 3, 4];
        for (i in list){
          yadcf_options.push({
            column_number : list[i],
            filter_type: "multi_select",
            select_type: "select2",
            filter_default_label: "",
            filter_reset_button_text: false,
            select_type_options: {
                width: "100%",
            }
          });
        }
        // init yadcf
        yadcf.init(datatable, yadcf_options);
        function updateJvenn(gprotein_ID) {
          displaySwitch = false;
          var seriesTable = new Array();
          var num = 0;
          for(var i=1; i<=gprotein_ID.length; i++) {
            seriesTable.push({
              name: gprotein_ID[i-1],
              data: getArrayFromData(gprotein_ID[i-1])
            });
          }

            $("#jvenn-container").jvenn({
            series: seriesTable,
            colors: ["rgb(255,255,255)","rgb(255,255,255)","rgb(255,255,255)","rgb(255,255,255)","rgb(255,255,255)"],//["rgb(0,102,0)","rgb(90,155,212)","rgb(241,90,96)","rgb(250,220,91)","rgb(255,117,0)","rgb(192,152,83)"],
            fontSize:   fontSize,
            fontFamily: fontFamily,
            searchInput:  $("#search-field"),
            searchStatus: $("#search-status"),
            displayMode: displayMode,
            shortNumber: shortNumber,
            displaySwitch: displaySwitch,
            displayStat: displayStat,
            exporting: true,
            fnClickCallback: function() {
              var dict = {{ receptor_dictionary|safe }};
              var value = "";
              datatable.clear().draw();
              for (val in this.list) {
                item = this.list[val].split('_')[0].toUpperCase();
                datatable.row.add([
                  dict[item][0],
                  dict[item][1],
                  dict[item][2],
                  dict[item][3],
                  dict[item][4],
                ]);
                value += this.list[val] + " ";
              }
              datatable.draw();
              $("td").each(function(){
                 $(this).addClass("expand");
              });
              $( "#copytoclip" ).unbind( "click" );
              $( "#copytoclip" ).bind( "click", function(event){copyToClipboard(value);});
            }

          });
          var totalCount = 0;
          $(".number-black").each(function(){
            totalCount = totalCount + parseInt($(this).text());
          });

          var paper_paths = [];
          paper.setup("test-canvas");
          $("#canvasEllipse svg g g").each(function(index){
            var transform = this.getAttribute("transform").parseTransform();
            paper_paths[index] = new paper.Path(this.firstChild.getAttribute("d"));
            paper_paths[index].scale(transform.scale.x, transform.scale.y);
            paper_paths[index].translate(transform.translate.x, transform.translate.y);
            paper_paths[index].rotate(transform.rotate.a);
            paper_paths[index].strokeColor = new paper.Color(0, 0, 0);
            // Viz
            paper_paths[index].fillColor = '#000000';
          });


          // All possible combinations
          var sets = Array.from(Array(paper_paths.length).keys())
          var combinations = getCombinations([...sets]);
          for (var i=0; i <combinations.length; i++){
            var included = combinations[i];
            track = trackTranslate[included.join('')];
            if (included.length > 0){
              var excluded = sets.filter(value => !included.includes(value));
              // create unique path
              var result = paper_paths[included[0]];  // intersect circle 1 with circle 2
              for (var j=1; j < included.length; j++){
                result = result.intersect(paper_paths[included[j]])
              }
              for (var j=0; j < excluded.length; j++){
                result = result.subtract(paper_paths[excluded[j]])
              }
              // draw path
              var svgPathElement = result.exportSVG(),
              dPath = svgPathElement.getAttribute('d');
              // find the correct ID number location
              var percentage = 200*(parseInt(document.getElementById(track).textContent)/totalCount);
              var gray=componentToHex(255-Math.round(percentage/100*255));
              var color="#"+gray+gray+gray;
              let g = $("#canvasEllipse svg g").get(0); // grab svg panel
              var newElement = document.createElementNS("http://www.w3.org/2000/svg", 'path');
              newElement.setAttribute("d", dPath); //Set path's data
              newElement.setAttribute("fill-opacity", 0.5);
              newElement.style.stroke = "black";
              newElement.style.strokeWidth = "1px";
              newElement.style.fill = color;
              g.appendChild(newElement);
            }
          }

        }

        updateJvenn(gprotein_ID)

        $("#ClassA").click(function() {
            datatable.clear().draw();
            $("#input-targets").val('');
            $("#input-targets").trigger('input');
            gprotein_list = {{ ClassA_gtp_plus_keys|safe }}
            gdata = {{ ClassA_gtp_plus|safe }}
            $("#ClassA").addClass("active");
            $("#ClassB1").removeClass("active");
            $("#ClassC").removeClass("active");
            $("#ClassF").removeClass("active");
            $("#CrossClass").removeClass("active");
          updateJvenn(gprotein_list);
        });

        $("#ClassA2s").click(function() {
            datatable.clear().draw();
            $("#input-targets").val('');
            $("#input-targets").trigger('input');
            gprotein_list = {{ ClassA_keys|safe }}
            gdata = {{ ClassA|safe }}
            $("#ClassA2s").addClass("active");
            $("#ClassB12s").removeClass("active");
            $("#ClassC2s").removeClass("active");
            $("#ClassF2s").removeClass("active");
            $("#CrossClass2s").removeClass("active");
          updateJvenn(gprotein_list);
        });

        $("#ClassB1").click(function() {
            datatable.clear().draw();
            $("#input-targets").val('');
            $("#input-targets").trigger('input');
            gprotein_list = {{ ClassB1_gtp_plus_keys|safe }}
            gdata = {{ ClassB1_gtp_plus|safe }}
            $("#ClassA").removeClass("active");
            $("#ClassB1").addClass("active");
            $("#ClassC").removeClass("active");
            $("#ClassF").removeClass("active");
            $("#CrossClass").removeClass("active");
          updateJvenn(gprotein_list);
        });

        $("#ClassB12s").click(function() {
            datatable.clear().draw();
            $("#input-targets").val('');
            $("#input-targets").trigger('input');
            gprotein_list = {{ ClassB1_keys|safe }}
            gdata = {{ ClassB1|safe }}
            $("#ClassA2s").removeClass("active");
            $("#ClassB12s").addClass("active");
            $("#ClassC2s").removeClass("active");
            $("#ClassF2s").removeClass("active");
            $("#CrossClass2s").removeClass("active");
          updateJvenn(gprotein_list);
        });

        $("#CrossClass").click(function() {
            datatable.clear().draw();
            $("#input-targets").val('');
            $("#input-targets").trigger('input');
            gprotein_list = {{ ClassA_gtp_plus_keys|safe }}
            gdataA = {{ ClassA_gtp_plus|safe }}
            gdataB1 = {{ ClassB1_gtp_plus|safe }}
            gdataC = {{ ClassC_gtp_plus|safe }}
            gdataF = {{ ClassF_gtp_plus|safe }}

            gdata['Gs'] = gdataA['Gs']+gdataB1['Gs']+gdataC['Gs']+gdataF['Gs']
            gdata['Gi/Go'] = gdataA['Gi/Go']+gdataB1['Gi/Go']+gdataC['Gi/Go']+gdataF['Gi/Go']
            gdata['Gq/G11'] = gdataA['Gq/G11']+gdataB1['Gq/G11']+gdataC['Gq/G11']+gdataF['Gq/G11']
            gdata['G12/G13'] = gdataA['G12/G13']+gdataB1['G12/G13']+gdataC['G12/G13']+gdataF['G12/G13']
            $("#ClassA").removeClass("active");
            $("#ClassB1").removeClass("active");
            $("#ClassC").removeClass("active");
            $("#ClassF").removeClass("active");
            $("#CrossClass").addClass("active");
          updateJvenn(gprotein_list);
        });

        $("#CrossClass2s").click(function() {
            datatable.clear().draw();
            $("#input-targets").val('');
            $("#input-targets").trigger('input');
            gprotein_list = {{ ClassA_keys|safe }}
            gdataA = {{ ClassA|safe }}
            gdataB1 = {{ ClassB1|safe }}
            gdataC = {{ ClassC|safe }}
            gdataF = {{ ClassF|safe }}

            gdata['Gs'] = gdataA['Gs']+gdataB1['Gs']+gdataC['Gs']+gdataF['Gs']
            gdata['Gi/Go'] = gdataA['Gi/Go']+gdataB1['Gi/Go']+gdataC['Gi/Go']+gdataF['Gi/Go']
            gdata['Gq/G11'] = gdataA['Gq/G11']+gdataB1['Gq/G11']+gdataC['Gq/G11']+gdataF['Gq/G11']
            gdata['G12/G13'] = gdataA['G12/G13']+gdataB1['G12/G13']+gdataC['G12/G13']+gdataF['G12/G13']
            $("#ClassA2s").removeClass("active");
            $("#ClassB12s").removeClass("active");
            $("#ClassC2s").removeClass("active");
            $("#ClassF2s").removeClass("active");
            $("#CrossClass2s").addClass("active");
          updateJvenn(gprotein_list);
        });

        $("#ClassC").click(function() {
            datatable.clear().draw();
            $("#input-targets").val('');
            gprotein_list = {{ ClassC_gtp_plus_keys|safe }}
            gdata = {{ ClassC_gtp_plus|safe }}
            $("#ClassA").removeClass("active");
            $("#ClassB1").removeClass("active");
            $("#ClassC").addClass("active");
            $("#ClassF").removeClass("active");
            $("#CrossClass").removeClass("active");
          updateJvenn(gprotein_list);
        });

        $("#ClassC2s").click(function() {
            datatable.clear().draw();
            $("#input-targets").val('');
            gprotein_list = {{ ClassC_keys|safe }}
            gdata = {{ ClassC|safe }}
            $("#ClassA2s").removeClass("active");
            $("#ClassB12s").removeClass("active");
            $("#ClassC2s").addClass("active");
            $("#ClassF2s").removeClass("active");
            $("#CrossClass2s").removeClass("active");
          updateJvenn(gprotein_list);
        });

        $("#ClassF").click(function() {
            datatable.clear().draw();
            $("#input-targets").val('');
            $("#input-targets").trigger('input');
            gprotein_list = {{ ClassF_gtp_plus_keys|safe }}
            gdata = {{ ClassF_gtp_plus|safe }}
            $("#ClassA").removeClass("active");
            $("#ClassB1").removeClass("active");
            $("#ClassC").removeClass("active");
            $("#ClassF").addClass("active");
            $("#CrossClass").removeClass("active");
          updateJvenn(gprotein_list);
        });

        $("#ClassF2s").click(function() {
            datatable.clear().draw();
            $("#input-targets").val('');
            $("#input-targets").trigger('input');
            gprotein_list = {{ ClassF_keys|safe }}
            gdata = {{ ClassF|safe }}
            $("#ClassA2s").removeClass("active");
            $("#ClassB12s").removeClass("active");
            $("#ClassC2s").removeClass("active");
            $("#ClassF2s").addClass("active");
            $("#CrossClass2s").removeClass("active");
          updateJvenn(gprotein_list);
        });

      });

      {% endif %}
  </script>

<script>
  // Transform parser
  String.prototype.parseTransform = function() {
  	var prop = ['translate', 'matrix', 'rotate', 'skewX', 'skewY', 'scale'];
  	var val = this.match(/(translate|matrix|rotate|skewX|skewY|scale)\(.*?\)/g);
  	var obj = {};
  	if (val) {
  		for (var i = 0, length = val.length; i < length; i++) {
  			var item = val[i];
  			var index = item.indexOf('(');
  			var v = item.substring(index + 1, item.length - 1).split(/\,|\s/);
  			var n = item.substring(0, index);
  			obj[n] = {};
  			switch (n) {
  				case 'translate':
  				case 'scale':
  					obj[n].x = +v[0] || 0;
  					obj[n].y = +v[1] || 0;
  					break;
  				case 'rotate':
  					obj[n].a = +v[0] || 0;
  					obj[n].x = +v[1] || 0;
  					obj[n].y = +v[2] || 0;
  					break;
  				case 'skewX':
  				case 'skewY':
  					obj[n].a = +v[0];
  					break;
  				case 'matrix':
  					obj[n].a = +v[0] || 0;
  					obj[n].b = +v[1] || 0;
  					obj[n].c = +v[2] || 0;
  					obj[n].d = +v[3] || 0;
  					obj[n].e = +v[4] || 0;
  					obj[n].f = +v[5] || 0;
  					break;
  			}
  		}
  	}

  	obj.toString = function() {
  		var builder = [];
  		for (var i = 0, length = prop.length; i < length; i++) {
  			var n = prop[i];
  			var o = this[n];
  			if (!o)
  				continue;
  			switch (n) {
  				case 'translate':
  				case 'scale':
  					builder.push(n + '(' + o.x + ',' + o.y + ')');
  					break;
  				case 'rotate':
  					builder.push(n + '(' + o.a + ' ' + o.x + ' ' + o.y + ')');
  					break;
  				case 'skewX':
  				case 'skewY':
  					builder.push(n + '(' + o.a + ')');
  					break;
  				case 'matrix':
  					builder.push(n + '(' + o.a + ',' + o.b + ',' + o.c + ',' + o.d + ',' + o.e + ',' + o.f + ')');
  					break;
  			}
  		}
  		return builder.join(' ');
  	};

  	return obj;
  };


  function getCombinations(array) {
      console.log(array);
      function iter(temp, index) {
          if (index >= array.length) {
              result.push(temp);
              return;
          }

          iter([...temp, array[index]], index + 1);
          iter(temp, index + 1);
      }

      var result = [];
      iter([], 0);
      return result;
  }
  function componentToHex(c)
  {
      var hex = c.toString(16);
      return hex.length == 1 ? "0" + hex : hex;
  }
</script>

<style type="text/css">
  /* Maintain original width of page */
  @media (min-width: 1600px) {
    #content.container {
      width: 1170px;
    }
  }

  .gprot_blue {
    color: blue;
  }

  .gprot_red {
    color: red;
  }

  .gprot_black {
    color: black;
  }

  .gprot_green {
    color: forestgreen;
  }

  textarea {
    resize: none;
    overflow: hidden;
  }
  canvas#test-canvas {
    display: none;
  }
</style>

<style>
  .node circle {
    stroke: #000000 ;
    stroke-width: .3px;
  }
  .node {
    font: 8px sans-serif;
  }
  .link {
    fill: none;
    stroke: #eee;
    stroke-width: 1px;
  }
  .node text {
    font: 8px sans-serif;
  }
  .links {
    fill: none;
    stroke: #000;
  }
  .link-extensions {
    fill: none;
    stroke: #000;
    stroke-opacity: .25;
  }
  .labels {
    font: 14px Palatino;
    font-weight: bold;
  }
  .link--active {
    stroke: #000 !important;
    stroke-width: 3.5px;
  }
  .link-extension--active {
    stroke-opacity: .6;
  }
  .label--active {
    font-weight: bold;
  }
</style>

{% if render_part != "tree" %}
<div class="container">
  <div class="row-fluid">
    <div class="span12">
      <div class="row-fluid">
        <div class="span6">
          <div class="btn-toolbar" role="toolbar">
            <p style="clear:both;text-align:center;">
              <div class="btn-group" role="group" id="gtp_plus">
                  <button id="ClassA" class="btn btn-primary active">A</button>
                  <button id="ClassB1" class="btn btn-primary">B1</button>
                  <button id="ClassC" class="btn btn-primary">C</button>
                  <button id="ClassF" class="btn btn-primary">F</button>
                  <button id="CrossClass" class="btn btn-primary">Cross</button>
              </div>
              <div class="btn-group" role="group" id="any_2_srcs" style="display:none">
                  <button id="ClassA2s" class="btn btn-info">A</button>
                  <button id="ClassB12s" class="btn btn-info">B1</button>
                  <button id="ClassC2s" class="btn btn-info">C</button>
                  <button id="ClassF2s" class="btn btn-info">F</button>
                  <button id="CrossClass2s" class="btn btn-info">Cross</button>
              </div>
                <input id="toggleswitch" type="checkbox" checked data-toggle="toggle" data-onstyle="primary" data-offstyle="info" data-on="GtP +" data-off="Any 2 sources" style="margin-left:10px;">
            </p>
          </div>
          <div class="row-fluid">
            <div id="jvenn-container"></div>
          </div>
        </div>

        <div class="span6">
          <div>
            <p> Click on an area of the venn diagram or a receptor clade on the phylogenetic G-protein selectivity tree to display the respective receptor sets: </p>
          </div>
          <table class="compact text-nowrap" id="receptor_table">
            <thead>
              <tr>
                  <th>Class</th>
                  <th>Ligand type</th>
                  <th>Family</th>
                  <th>Receptor<br>(UniProt)</th>
                  <th>Receptor<br>(GtP)</th>
              </tr>
              <tr>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
              </tr>
            </thead>
          </table>

        </div>
        <button id="copytoclip" type="button" class="btn btn-info" style="float:right;margin-top:10px;"> Copy to clipboard </button>
        <input id="cb" type="text" hidden>
        <canvas id="test-canvas"></canvas>
        </div>
      </div>
    </div>
  </div>
  <hr>
</div>
{% endif %}

<script>
  $(function() {
    $('#toggleswitch').change(function() {
      var gtp = document.getElementById("gtp_plus");
      var a2s = document.getElementById("any_2_srcs");
      var click2s = document.getElementById("ClassA2s");
      var clickgtp = document.getElementById("ClassA");
      a2s.style.display = "none";
      if (gtp.style.display === "none") {
        gtp.style.display = "block";
        a2s.style.display = "none";
        clickgtp.click();
        DrawCircles('tree_class_a',selectivitydata_gtp_plus);
        DrawCircles('tree_class_b1',selectivitydata_gtp_plus);
        DrawCircles('tree_class_b2',selectivitydata_gtp_plus);
        DrawCircles('tree_class_c',selectivitydata_gtp_plus);
        DrawCircles('tree_class_f',selectivitydata_gtp_plus);
        DrawCircles('tree_class_t2',selectivitydata_gtp_plus);
        $("#ClassA").addClass("active");
      } else {
        gtp.style.display = "none";
        a2s.style.display = "block";
        click2s.click();
        DrawCircles('tree_class_a',selectivitydata);
        DrawCircles('tree_class_b1',selectivitydata);
        DrawCircles('tree_class_b2',selectivitydata);
        DrawCircles('tree_class_c',selectivitydata);
        DrawCircles('tree_class_f',selectivitydata);
        DrawCircles('tree_class_t2',selectivitydata);
        $("#ClassA2s").addClass("active");
      }
    })
  })
</script>



<script>
  ! function($) {
    $(function() {
      window.prettyPrint && prettyPrint()
    })
  }(window.jQuery)
</script>


<script type="text/javascript" charset="utf-8">
  var receptor_dictionary = {{ receptor_dictionary|safe }};
  var selectivitydata = {{ selectivitydata|safe }};
  var selectivitydata_gtp_plus = {{ selectivitydata_gtp_plus|safe }};
  $(document).ready(function(){
    paper.install(window);
    });
</script>

{% if render_part != "venn" %}
<script type="text/javascript" charset="utf-8">
    tree_class_a = {{ tree_class_a|safe }};
    tree_class_a_options = {{ tree_class_a_options|safe }};
    tree_class_b1 = {{ tree_class_b1|safe }};
    tree_class_b1_options = {{ tree_class_b1_options|safe }};
    tree_class_b2 = {{ tree_class_b2|safe }};
    tree_class_b2_options = {{ tree_class_b2_options|safe }};
    tree_class_c = {{ tree_class_c|safe }};
    tree_class_c_options = {{ tree_class_c_options|safe }};
    tree_class_f = {{ tree_class_f|safe }};
    tree_class_f_options = {{ tree_class_f_options|safe }};
    tree_class_t2 = {{ tree_class_t2|safe }};
    tree_class_t2_options = {{ tree_class_t2_options|safe }};
</script>
<script type="text/javascript" charset="utf-8">

function DrawCircles(location, data){
    var svg = d3.select('#'+location);
    var node = svg.selectAll(".node");
    node.selectAll("circle").remove();
    for (var x in data){
      var spacer = 8
      if (data[x].indexOf("Gs")>= 0) {
        var leafwithname = svg.selectAll('g[id=X'+x+']')
            .append("circle")
            .attr("r", 3.25)
            .style("fill", "blue")
            .attr("transform", "translate(" + (42 + spacer) + ",0)");
          }

      if (data[x].indexOf("Gi/Go")>= 0) {
        var leafwithname = svg.selectAll('g[id=X'+x+']')
            .append("circle")
            .attr("r", 3.25)
            .style("fill", "red")
            .attr("transform", "translate(" + (42 + 2*spacer) + ",0)");
          }

      if (data[x].indexOf("Gq/G11")>= 0) {
        var leafwithname = svg.selectAll('g[id=X'+x+']')
            .append("circle")
            .attr("r", 3.25)
            .style("fill", "black")
            .attr("transform", "translate(" + (42 + 3*spacer) + ",0)");
        }

      if (data[x].indexOf("G12/G13")>= 0) {
        var leafwithname = svg.selectAll('g[id=X'+x+']')
            .append("circle")
            .attr("r", 3.25)
            .style("fill", "green")
            .attr("transform", "translate(" + (42 + 4*spacer) + ",0)");
        }
    }
  }

$(window).on("load",function() {
    draw_tree(tree_class_a, tree_class_a_options);
    DrawCircles('tree_class_a',selectivitydata_gtp_plus);
    draw_tree(tree_class_b1, tree_class_b1_options);
    DrawCircles('tree_class_b1',selectivitydata_gtp_plus);
    draw_tree(tree_class_b2, tree_class_b2_options);
    DrawCircles('tree_class_b2',selectivitydata_gtp_plus);
    draw_tree(tree_class_c, tree_class_c_options);
    DrawCircles('tree_class_c',selectivitydata_gtp_plus);
    draw_tree(tree_class_f, tree_class_f_options);
    DrawCircles('tree_class_f',selectivitydata_gtp_plus);
    draw_tree(tree_class_t2, tree_class_t2_options);
    DrawCircles('tree_class_t2',selectivitydata);
    $("#tree_class_a svg g").first().attr('transform', 'translate(555,555) scale(0.9,0.9) ');
    $("#tree_class_b1 svg g").first().attr('transform', 'translate(220,220) scale(0.85,0.85) ');
    $("#tree_class_b2 svg g").first().attr('transform', 'translate(220,182) scale(0.85,0.85) ');
    $("#tree_class_c svg g").first().attr('transform', 'translate(200,200) scale(0.85,0.85) ');
    $("#tree_class_f svg g").first().attr('transform', 'translate(180,180) scale(0.85,0.85) ');
    $("#tree_class_t2 svg g").first().attr('transform', 'translate(172,172) scale(0.85,0.85) ');
});
</script>

  <div class="row">
    <div class="col-md-12">
      <div class="panel-body">
        <div class='text-center'>
          <p><strong>GPCR selectivity tree.</strong> The four dots depict both primary and secondary G protein coupling (from inside to outside: <a href="family/100_001_001/">G&alpha;<sub>s</sub></a>,
            <a href="family/100_001_002/">G&alpha;<sub>i/o</sub></a>, <a href="family/100_001_003/">G&alpha;<sub>q/11</sub></a>, <a href="family/100_001_004/">G&alpha;<sub>12/13</sub></a>).</p>
        </div>
      </div>
    </div>
  </div>

  <div class="row text-center">
      <span class="gprot_blue">&#11044; G&alpha;<sub>s</sub></span>
      <span class="gprot_red">&#11044; G&alpha;<sub>i/o</sub></span>
      <span class="gprot_black">&#11044; G&alpha;<sub>q/11</sub></span>
      <span class="gprot_green">&#11044; G&alpha;<sub>12/13</sub></span>
  </div>

  <br />

<div id="tree_class_a" class="text-center">
  <h4>Class A<br />(Rhodopsin)</h4>
</div>

<!-- adding the section of graphs from StructureStatistics -->

<p>
  <div class="text-center">
    <div class="btn-group">
        <button type="button" class="btn btn-sm btn-primary dropdown-toggle" data-toggle="dropdown"
                aria-haspopup="true" aria-expanded="false">
            <span class="glyphicon glyphicon-download"></span> Download <span class="caret"></span>
        </button>
        <ul class="dropdown-menu">
            <li>
                <a href="javascript:saveSvgAsPng(document.getElementById('tree_class_a_svg'), 'xtals_tree_class_a.png');">PNG</a>
            </li>
            <li>
                <a href="javascript:saveSvgAsJpg(document.getElementById('tree_class_a_svg'), 'xtals_tree_class_a.jpg');">JPG</a>
            </li>
            <li>
                <a href="javascript:saveSvgAsTiff(document.getElementById('tree_class_a_svg'), 'xtals_tree_class_a.tiff');">TIFF</a>
            </li>
            <li>
                <a href="javascript:saveSvg(document.getElementById('tree_class_a_svg'), 'xtals_tree_class_a.svg');">SVG</a>
            </li>
        </ul>
    </div>
  </div>

    <br />
    <br />
    <br />
    <table>
        <tr>
            <td align="center">
                <h4>Class B1<br />(Secretin)</h4>
            </td>
            <td align="center">
                <h4>Class B2<br />(Adhesion)</h4>
            </td>
            <td align="center">
                <h4>Class C<br />(Glutamate)</h4>
            </td>
        </tr>
        <tr>
            <td width="33%" style="padding: 20px">
                <div id="tree_class_b1"></div>
            </td>
            <td width="33%" style="padding: 20px">
                <div id="tree_class_b2"></div>
            </td>
            <td width="33%" style="padding: 20px">
                <div id="tree_class_c"></div>

            </td>
        </tr>
        <tr>
            <td width="33%" style="padding: 20px" class="text-center">
                <div class="btn-group">
                    <button type="button" class="btn btn-sm btn-primary dropdown-toggle" data-toggle="dropdown"
                            aria-haspopup="true" aria-expanded="false">
                        <span class="glyphicon glyphicon-download"></span> Download <span class="caret"></span>
                    </button>
                    <ul class="dropdown-menu">
                        <li>
                            <a href="javascript:saveSvgAsPng(document.getElementById('tree_class_b1_svg'), 'xtal_coverage_tree_class_b1.png');">PNG</a>
                        </li>
                        <li>
                            <a href="javascript:saveSvgAsJpg(document.getElementById('tree_class_b1_svg'), 'xtal_coverage_tree_class_b1.jpg');">JPG</a>
                        </li>
                        <li>
                            <a href="javascript:saveSvgAsTiff(document.getElementById('tree_class_b1_svg'), 'xtal_coverage_tree_class_b1.tiff');">TIFF</a>
                            </a>
                        </li>
                        <li>
                            <a href="javascript:saveSvg(document.getElementById('tree_class_b1_svg'), 'xtal_coverage_tree_class_b1.svg');">SVG</a>
                        </li>
                    </ul>
                </div>
            </td>
            <td width="33%" style="padding: 20px" class="text-center">
                <div class="btn-group">
                    <button type="button" class="btn btn-sm btn-primary dropdown-toggle" data-toggle="dropdown"
                            aria-haspopup="true" aria-expanded="false">
                        <span class="glyphicon glyphicon-download"></span> Download <span class="caret"></span>
                    </button>
                    <ul class="dropdown-menu">
                        <li>
                            <a href="javascript:saveSvgAsPng(document.getElementById('tree_class_b2_svg'), 'xtal_coverage_tree_class_b2.png');">PNG</a>
                        </li>
                        <li>
                            <a href="javascript:saveSvgAsJpg(document.getElementById('tree_class_b2_svg'), 'xtal_coverage_tree_class_b2.jpg');">JPG</a>
                        </li>
                        <li>
                            <a href="javascript:saveSvgAsTiff(document.getElementById('tree_class_b2_svg'), 'xtal_coverage_tree_class_b2.tiff');">TIFF</a>
                        </li>
                        <li>
                            <a href="javascript:saveSvg(document.getElementById('tree_class_b2_svg'), 'xtal_coverage_tree_class_b2.svg');">SVG</a>
                        </li>
                    </ul>
                </div>
            </td>
            <td width="33%" style="padding: 20px" class="text-center">
                <div class="btn-group">
                    <button type="button" class="btn btn-sm btn-primary dropdown-toggle" data-toggle="dropdown"
                            aria-haspopup="true" aria-expanded="false">
                        <span class="glyphicon glyphicon-download"></span> Download <span class="caret"></span>
                    </button>
                    <ul class="dropdown-menu">
                        <li>
                            <a href="javascript:saveSvgAsPng(document.getElementById('tree_class_c_svg'), 'xtal_coverage_tree_class_c.png');">PNG</a>
                        </li>
                        <li>
                            <a href="javascript:saveSvgAsJpg(document.getElementById('tree_class_c_svg'), 'xtal_coverage_tree_class_c.jpg');">JPG</a>
                        </li>
                        <li>
                            <a href="javascript:saveSvgAsTiff(document.getElementById('tree_class_c_svg'), 'xtal_coverage_tree_class_c.tiff');">TIFF</a>
                            </a>
                        </li>
                        <li>
                            <a href="javascript:saveSvg(document.getElementById('tree_class_c_svg'), 'xtal_coverage_tree_class_c.svg');">SVG</a>
                        </li>
                    </ul>
                </div>
            </td>
        </tr>
    </table>
    <table width="100%">
        <tr>
            <td width="50%" align="center">
                <h4>Class F<br />(Frizzled)</h4>
            </td>
            <td width="50%" align="center">
                <h4>Class T (Taste 2)</h4>
            </td>
        </tr>
        <tr>
            <td width="50%" align="center" style="padding: 20px">
                <div id="tree_class_f"></div>
            </td>
            <td width="50%" align="center" style="padding: 20px">
                <div id="tree_class_t2"></div>
            </td>
        </tr>
        <tr>
            <td width="50%" style="padding: 20px" class="text-center">
                <div class="btn-group">
                    <button type="button" class="btn btn-sm btn-primary dropdown-toggle" data-toggle="dropdown"
                            aria-haspopup="true" aria-expanded="false">
                        <span class="glyphicon glyphicon-download"></span> Download <span class="caret"></span>
                    </button>
                    <ul class="dropdown-menu">
                        <li>
                            <a href="javascript:saveSvgAsPng(document.getElementById('tree_class_f_svg'), 'xtal_coverage_tree_class_f.png');">PNG</a>
                        </li>
                        <li>
                            <a href="javascript:saveSvgAsJpg(document.getElementById('tree_class_f_svg'), 'xtal_coverage_tree_class_f.jpg');">JPG</a>
                        </li>
                        <li>
                            <a href="javascript:saveSvgAsTiff(document.getElementById('tree_class_f_svg'), 'xtal_coverage_tree_class_f.tiff');">TIFF</a>
                            </a>
                        </li>
                        <li>
                            <a href="javascript:saveSvg(document.getElementById('tree_class_f_svg'), 'xtal_coverage_tree_class_f.svg');">SVG</a>
                                </a>
                        </li>
                    </ul>
                </div>
            </td>
            <td width="50%" style="padding: 20px" class="text-center">
                <div class="btn-group">
                    <button type="button" class="btn btn-sm btn-primary dropdown-toggle" data-toggle="dropdown"
                            aria-haspopup="true" aria-expanded="false">
                        <span class="glyphicon glyphicon-download"></span> Download <span class="caret"></span>
                    </button>
                    <ul class="dropdown-menu">
                        <li>
                            <a href="javascript:saveSvgAsPng(document.getElementById('tree_class_t2_svg'), 'xtal_coverage_tree_t2.png');">PNG</a>
                        </li>
                        <li>
                            <a href="javascript:saveSvgAsJpg(document.getElementById('tree_class_t2_svg'), 'xtal_coverage_tree_t2.jpg');">JPG</a>
                        </li>
                        <li>
                            <a href="javascript:saveSvgAsTiff(document.getElementById('tree_class_t2_svg'), 'xtal_coverage_tree_t2.tiff');">TIFF</a>
                            </a>
                        </li>
                        <li>
                            <a href="javascript:saveSvg(document.getElementById('tree_class_t2_svg'), 'xtal_coverage_tree_t2.svg');">SVG</a>
                                </a>
                        </li>
                    </ul>
                </div>
            </td>
        </tr>
    </table>

<!-- end added section -->
  <hr>
{% endif %}

<div class='col-md-12'>
  <h4>Reference:</h4>
  <p>
    We used the G protein transducer imformation from the
    <a href='http://www.guidetopharmacology.org'>GuideToPharmacology</a> (IUPHAR): </p>
  <p>


    Armstrong, J. F., Faccenda, E., Harding, S. D., Pawson, A. J., Southan, C., Sharman, J. L., Campo, B., Cavanagh, D. R., Alexander, S. P. H., Davenport, A. P., Spedding, M., Davies, J. A. & NC-IUPHAR.<br>
    <b>The IUPHAR/BPS Guide to PHARMACOLOGY in 2020: extending immunopharmacology content and introducing the IUPHAR/MMV Guide to MALARIA PHARMACOLOGY.</b><br>
    <a href="https://doi.org/10.1093/nar/gkz951" target="_blank"><i>Nucleic Acids Res</i></a> <b>48</b>, D1006â€“D1021 (2020).<br>
    [PMID:<a href="http://www.ncbi.nlm.nih.gov/pubmed/31691834" target="_blank">31691834</a>]
  </p>
  <p>
    Inoue, A., Raimondi, F., Kadji, F. M. N., Singh, G., Kishi, T., Uwamizu, A., Ono, Y., Shinjo, Y., Ishida, S., Arang, N., Kawakami, K., Gutkind, J. S., Aoki, J. & Russell, R. B.<br>
    <b>Illuminating G-Protein-Coupling Selectivity of GPCRs.</b> <br>
    <i><a href="https://doi.org/10.1016/j.cell.2019.04.044" target="_blank">Cell</a></i> <b>177</b>, 1933-1947.e25 (2019).<br>
    [PMID:<a href="https://pubmed.ncbi.nlm.nih.gov/31160049/" target="_blank">31160049</a>]
  </p>
  <p>
    Avet, C., Mancini, A., Breton, B., Gouill, C. L., Hauser, A. S., Normand, C., Kobayashi, H., Gross, F., Hogue, M., Lukasheva, V., Morissette, S., Fauman, E., Fortin, J.-P., Schann, S., Leroy, X., Gloriam, D. E. & Bouvier, M.<br>
    <b>Selectivity Landscape of 100 Therapeutically Relevant GPCR Profiled by an Effector Translocation-Based BRET Platform.</b><br>
    <i><a href="https://www.biorxiv.org/content/10.1101/2020.04.20.052027v1" target="_blank">bioRxiv</a></i> 2020.04.20.052027 (2020).<br>
    <b>doi:</b> <a href=" https://doi.org/10.1101/2020.04.20.052027" target="_blank">10.1101/2020.04.20.052027</a>
  </p>

</div>

{% endblock %}
{% block addon_js %}
<script src="{% static 'home/js/d3.min.js' %}"></script>
<script src="{% static 'home/js/newick.js' %}"></script>
{% if render_part != "venn" %}
  <script src="{% static 'home/js/phylo_tree.js' %}"></script>
{% endif %}
<script src="{% static 'home/js/bootstrap-toggle.min.js' %}"></script>
<script src="{% static 'home/js/targetselect_functions.js' %}"></script>
<script src="{% static 'home/js/select2.js' %}"></script>
<script src="{% static 'home/js/jquery.dataTables.yadcf.js' %}"></script>
<script src="{% static 'home/js/jquery.dataTables.min.js' %}"></script>
<script src="{% static 'home/js/paper-full.min.js' %}"></script>
<script src="{% static 'home/js/bootstrap-colorpicker.min.js' %}"></script>
<script src="{% static 'home/js/canvas2svg.js' %}"></script>
<script src="{% static 'home/js/jvenn.js' %}"></script>
<script src="{% static 'home/js/nv.d3.min.js' %}"></script>
<script src="{% static 'home/js/saveSvgAsPng.js' %}"></script>
{% endblock %}
